<!DOCTYPE html>
<html>
<head>
    <title>Todo App</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="todo-container">
        <h1>Todo List App</h1>

        <!-- Filter Form -->
        <form class="filter-form" method="get" action="/">
            <select name="priority" onchange="this.form.submit()">
                <option value="All" <%= filter === 'All' ? 'selected' : '' %>>All</option>
                <option value="High" <%= filter === 'High' ? 'selected' : '' %>>High</option>
                <option value="Medium" <%= filter === 'Medium' ? 'selected' : '' %>>Medium</option>
                <option value="Low" <%= filter === 'Low' ? 'selected' : '' %>>Low</option>
            </select>
        </form>

        <!-- Add Task -->
        <form class="add-form" action="/add" method="post">
            <input type="text" name="text" placeholder="Add your new todo">
            <select name="priority">
                <option value="High">High</option>
                <option value="Medium" selected>Medium</option>
                <option value="Low">Low</option>
            </select>
            <button type="submit" class="add-btn">+</button>
        </form>

        <!-- Task List -->
        <div class="task-list">
            <% if (tasks.length === 0) { %>
                <p class="empty">No tasks found</p>
            <% } else { %>
                <% tasks.forEach(task => { %>
                    <div class="task-item">
                        <!-- Toggle Complete -->
                        <form action="/toggle/<%= task.id %>" method="post" style="display:inline;">
                            <button type="submit" class="toggle-btn"><%= task.completed ? "‚úÖ" : "‚≠ï" %></button>
                        </form>

                        <!-- Editable Text -->
                        <form action="/edit/<%= task.id %>?_method=PUT" method="post" style="display:inline;">
                            <input type="text" name="text" value="<%= task.text %>" class="<%= task.completed ? 'done' : '' %>">
                            <button type="submit" class="edit-btn">‚úè</button>
                        </form>

                        <!-- Priority Badge -->
                        <span class="badge <%= task.priority.toLowerCase() %>"><%= task.priority %></span>

                        <!-- Delete Task -->
                        <form action="/delete/<%= task.id %>?_method=DELETE" method="post" style="display:inline;">
                            <button type="submit" class="delete-btn">üóë</button>
                        </form>
                    </div>
                <% }) %>
            <% } %>
        </div>

        <!-- Footer -->
        <% if (tasks.length > 0) { %>
            <div class="footer">
                <span>You have <%= tasks.length %> pending tasks</span>
                <form action="/clear-all" method="post">
                    <button type="submit" class="clear-btn">Clear All</button>
                </form>
            </div>
        <% } %>
    </div>
</body>
</html>
